---
import { Icon } from 'astro-icon/components';
---

<button
  type="button"
  id="backToTop"
  class="fixed bottom-8 right-8 bg-primary-600 text-white p-3 rounded-full shadow-lg opacity-0 translate-y-10 transition-all duration-300 hover:bg-primary-700 hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:bg-primary-500 dark:hover:bg-primary-600 z-50 group"
  aria-label="ZurÃ¼ck nach oben"
>
  <Icon name="heroicons:arrow-up" class="w-6 h-6 transition-transform duration-300 group-hover:-translate-y-1" />
</button>

<script>
  const button = document.getElementById('backToTop');
  
  if (button) {
    // Show/hide button based on scroll position
    const toggleButton = () => {
      const scrolled = window.scrollY > 300;
      button.classList.toggle('opacity-0', !scrolled);
      button.classList.toggle('translate-y-10', !scrolled);
      button.classList.toggle('opacity-100', scrolled);
      button.classList.toggle('translate-y-0', scrolled);
      
      // Add pulse effect when button appears
      if (scrolled) {
        button.classList.add('animate-pulse');
        setTimeout(() => button.classList.remove('animate-pulse'), 1000);
      }
      
      // Add pulse effect when button appears
      if (scrolled) {
        button.classList.add('animate-pulse');
        setTimeout(() => button.classList.remove('animate-pulse'), 1000);
      }
    };

    // Initial check
    toggleButton();
    
    // Add scroll listener with debounce
    let timeout: number;
    window.addEventListener('scroll', () => {
      if (timeout) {
        window.cancelAnimationFrame(timeout);
      }
      timeout = window.requestAnimationFrame(toggleButton);
    }, { passive: true });

    // Smooth scroll to top with keyboard support
    button.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });

    button.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
    });
  }
</script>